package dev.realme.ash.impl.module.exploit;

import dev.realme.ash.api.event.listener.EventListener;
import dev.realme.ash.api.module.ModuleCategory;
import dev.realme.ash.api.module.ToggleModule;
import dev.realme.ash.impl.event.network.PacketEvent;
import dev.realme.ash.init.Managers;
import net.minecraft.network.packet.BrandCustomPayload;
import net.minecraft.network.packet.CustomPayload;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.c2s.common.CustomPayloadC2SPacket;
import net.minecraft.util.Identifier;

public class ClientSpoofModule
extends ToggleModule {
    public ClientSpoofModule() {
        super("ClientSpoof", "Spoofs your client brand", ModuleCategory.EXPLOITS);
    }

    @EventListener
    public void onPacketOutbound(PacketEvent.Send event) {
        Packet<?> packet = event.getPacket();
        if (packet instanceof CustomPayloadC2SPacket) {
            CustomPayloadC2SPacket packet2 = (CustomPayloadC2SPacket)packet;
            CustomPayload payload = packet2.payload();
            Identifier identifier = payload.id();
            if (identifier.getPath().equals("brand")) {
                event.setCanceled(true);
                Managers.NETWORK.sendQuietPacket(new CustomPayloadC2SPacket(new BrandCustomPayload("vanilla")));
                return;
            }
            if (identifier.getNamespace().equals("fabric") && !mc.isInSingleplayer()) {
                event.setCanceled(true);
            }
        }
    }
}
